<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.wenda.dao.FeedDao">
	<sql id="feed_fields">id, user_id,created_date,type,data</sql>
	
	<insert id="addFeed">
		insert into feed(<include refid="feed_fields"/>)
		values(#{id},#{userId},#{createdDate},#{type},#{data})
	</insert>
	<select id="getFeedById" resultMap="feed">
		select <include refid="feed_fields"/>
		from feed 
		where id=#{id}
	</select>
	<select id="selectUserFeeds" resultMap="feed">
		SELECT <include refid="feed_fields"/>
        FROM feed

        WHERE id &lt; #{maxId}

        <if test="userIds.size() != 0">
            AND user_id in
            <foreach item="item" index="index" collection="userIds"
                     open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        ORDER BY id DESC
        LIMIT #{count}

	</select>
	
	<resultMap type="cn.wenda.model.Feed" id="feed">
		<id property="id" column="id"/>
		<result property="userId" column="user_id"/>
		<result property="createdDate" column="created_date"/>
		<result property="type" column="type"/>
		<result property="data" column="data"/>
		
	</resultMap>
	
	
</mapper>